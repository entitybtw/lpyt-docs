name: build-offline html files

on:
  workflow_dispatch:
  push:
    branches: [ main, master ]

jobs:
  capture-pages:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Pull SingleFile Docker image
      run: docker pull capsulecode/singlefile

    - name: Tag SingleFile image
      run: docker tag capsulecode/singlefile singlefile

    - name: Capture all pages
      run: |
        PAGES=(intro docs build additional)
        THEMES=(dark light)
        LOCALES=(ru en)

        for page in "${PAGES[@]}"; do
          for theme in "${THEMES[@]}"; do
            for locale in "${LOCALES[@]}"; do
              filename="${page}_${theme}_${locale}.html"
              url="https://luaplayeryt.ru/#${page}/${theme}/${locale}"
              echo "Capturing $url -> $filename"
              docker run --rm singlefile "$url" > "$filename"
            done
          done
        done

    - name: Verify captured files
      run: |
        ls -la *.html
        for f in *.html; do
          echo "$f size:" $(wc -c < "$f") "bytes"
        done

    - name: Upload HTML artifacts
      uses: actions/upload-artifact@v4
      with:
        name: luaplayeryt-pages
        path: "*.html"
        retention-days: 30
